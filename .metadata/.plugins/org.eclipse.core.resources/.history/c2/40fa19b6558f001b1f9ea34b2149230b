import java.time.LocalDate;
import java.time.LocalTime;
import java.util.*;

public class Visitor extends person {
	int record_id;
	int Num_ofVisit;
	ArrayList<VisitorRecord> VisitorRecord1;
	Scanner input = new Scanner(System.in);

	public Visitor(String Name, String address, int ID, String NOT, LocalDate dob, int record_id, int Num_ofVisit) {
		super(Name, address, ID, NOT, dob);
		record_id = 100000;
		Num_ofVisit = 0;

	}

	public Visitor() {
		VisitorRecord1 =new ArrayList<VisitorRecord>();
		record_id = 100000;
		Num_ofVisit = 0;

	};

	public ArrayList<VisitorRecord> getVisitorRecord1() {
		return VisitorRecord1;
	}

	public void setVisitorRecord1(ArrayList<VisitorRecord> visitorRecord1) {
		VisitorRecord1 = visitorRecord1;
	}

	public int getRecord_id() {
		return record_id;
	}

	public void setRecord_id(int record_id) {
		this.record_id = record_id;
	}

	public int getNum_ofVisit() {
		return Num_ofVisit;
	}

	public void setNum_ofVisit(int num_ofVisit) {
		Num_ofVisit = num_ofVisit;
	}

	@Override
	public int getID() {
		// TODO Auto-generated method stub
		return super.getID();
	}

	@Override
	public void setID(int iD) {
		// TODO Auto-generated method stub
		super.setID(iD);
	}

	@SuppressWarnings("deprecation")
	public Ticket book_tour() {
		Reseptioniest R;
		R = new Reseptioniest();
		System.out.println("Welcome\nEnter your id");
		int idv1 = input.nextInt();
		if (R.availableSubs(idv1)) {

			System.out.println("You have a subscription Remaining in it" + R.getSubs(idv1).getCountofsubs() + "Days");
			System.out.println("your information is :" + R.Database().getvisitor(idv1).toString());

			if (R.getSubs(idv1).getTG() != null) {

				R.Database().Withguide(1, idv1, null);

			}
			int count;
			count = R.getSubs(idv1).getCountofsubs();
			count--;
			if (count == 0) {

				System.out.println("our subscription has expired\r\n"
						+ "If you want to renew the subscription Enter 1\nif you want delete Enter 2 ");
				int re = input.nextInt();
				if (re == 1) {
					System.out.println("Enter new subscriptions Type\n1.Weekly\n2.Monthly\n3.Yearly");
					int idy = input.nextInt();
					if (idy == 1) {

						R.getSubs(idv1).getTy().setTtype(Tickettype.WEEKLY);
						R.getSubs(idv1).setCountofsubs(5);
					} else if (idy == 2) {
						R.getSubs(idv1).getTy().setTtype(Tickettype.MONTHLY);
						R.getSubs(idv1).setCountofsubs(22);
					} else if (idy == 3) {

						R.getSubs(idv1).getTy().setTtype(Tickettype.YEARLY);
						R.getSubs(idv1).setCountofsubs(250);
					}

				}

			}
			R.getSubs(idv1).setCountofsubs(count);
			int nov = 0;
			nov = R.getSubs(idv1).getV1().getNum_ofVisit();
			nov++;
			R.getSubs(idv1).getV1().setNum_ofVisit(nov);
			System.out.println("Enter Date of tour(Day,Month,year):");
			int day = input.nextInt();
			int month = input.nextInt();
			int year = input.nextInt();
			LocalDate g = LocalDate.of(year, month, day);
			System.out.println("Enter Time of tour(hour,minute):");
			int hour = input.nextInt();
			int minute = input.nextInt();
			LocalTime l1 = LocalTime.of(hour, minute);
			R.Database().Withguide(2, idv1, null);
			VisitorRecord vr = new VisitorRecord();
			vr.setEnteringdate(g);
			vr.setEnteringtime(l1);
			R.getSubs(idv1).getV1().getVisitorRecord1().add(vr);
			VisitorRecord1.add(vr);
			System.out.println("Sucssesful");
			return R.getSubs(idv1).getTy();
		} else {
			System.out.println("Enter type of Ticket:\n1.Multi time ticket.\n2.One Time ticket.");
			int Tt = input.nextInt();
			if(Tt==1) {
				
				R.registersubs();
				return R.getSubs(idv1).getTy();
			}
			else if(Tt==2) {
			OneTimeTecket ot = new OneTimeTecket();
			VisitorRecord vr = new VisitorRecord();
			System.out.println("Are you want tour: 1.with guide,2.without guide\n");
			int egf3 = input.nextInt();
			if (R.Database().availablevisitor(idv1)) {
				R.issuetecketOne(ot, egf3, R.Database().getvisitor(idv1).getName());
				int nov = 0;
				nov = R.Database().getvisitor(idv1).getNum_ofVisit();
				nov++;
				R.Database().getvisitor(idv1).setNum_ofVisit(nov);
				System.out.println("Enter Date of tour(Day,Month,year):");
				int day = input.nextInt();
				int month = input.nextInt();
				int year = input.nextInt();
				LocalDate g2 = LocalDate.of(year, month, day);
				System.out.println("Enter Time of tour(hour,minute):");
				int hour = input.nextInt();
				int minute = input.nextInt();
				LocalTime l2 = LocalTime.of(hour, minute);
				vr.setEnteringdate(g2);
				vr.setEnteringtime(l2);
				VisitorRecord1.add(vr);
				R.Database().getvisitor(idv1).getVisitorRecord1().add(vr);
				R.Database().getvisitor(idv1).setID(idv1);
				R.Database().getvisitor(idv1).setName(name);
				ot.setV(R.Database().getvisitor(idv1));
				System.out.println("Your ticket price is:" + ot.getPrice() + "$");
				if (egf3 == 1) {
					R.Database().Withguide(2, idv1, ot);
					double price;
					price = ot.getPrice() + 8;
					ot.setPrice(price);

					System.out.println("Your ticket price is:" + ot.getPrice() + "$");
				} else {

					System.out.println("Your ticket price is:" + ot.getPrice() + "$");
				}
				return ot;
			} else {
				Visitor Vn = new Visitor();
				System.out.println("please Enter your name:");
				String name = input.next();
				R.issuetecketOne(ot, egf3, name);
				int Nu;
				Nu = Vn.getNum_ofVisit();
				Nu++;
				Vn.setNum_ofVisit(Nu);
				System.out.println("Enter Date of tour(Day,Month,year):");
				int day = input.nextInt();
				int month = input.nextInt();
				int year = input.nextInt();
				LocalDate g2 = LocalDate.of(year, month, day);
				System.out.println("Enter Time of tour(hour,minute):");
				int hour = input.nextInt();
				int minute = input.nextInt();
				LocalTime l2 = LocalTime.of(hour, minute);
				vr.setEnteringdate(g2);
				vr.setEnteringtime(l2);
				ArrayList<VisitorRecord> VisitorRecord2;
				VisitorRecord2 = new ArrayList<VisitorRecord>();
				VisitorRecord2.add(vr);
				Vn.setVisitorRecord1(VisitorRecord2);
				Vn.setID(idv1);
				Vn.setName(name);
				R.Database().getVlist().add(Vn);
				double price = 20;
				ot.setPrice(price);
				ot.setV(Vn);

				if (egf3 == 1) {
					R.Database().Withguide(2, idv1, ot);
				}
				return ot;
			}
			}
		}
		return null;

	}

	@Override
	public String toString() {
		return "Visitor [record_id=" + record_id + ", Num_ofVisit=" + Num_ofVisit + ", VisitorRecord1=" + VisitorRecord1
				+ ", name=" + name + ", address=" + address + ", ID=" + ID + ", NumOftelph=" + NumOftelph
				+ ", dateOfbirth=" + dateOfbirth + "]";
	}

}